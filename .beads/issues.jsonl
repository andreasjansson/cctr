{"id":"cctr-0a7","title":"Add corpus setup/teardown tests","description":"Add tests for the corpus-level setup/teardown feature.\n\n## Location\n`test/corpus_setup/`\n\n## Test Cases\n\n1. **Corpus setup runs before suites**\n   - `_setup_corpus.txt` creates a marker file\n   - Suite setup verifies marker exists\n   \n2. **Corpus teardown runs after suites**\n   - Suite creates a marker\n   - `_teardown_corpus.txt` verifies suite ran and cleans up\n\n3. **Corpus setup failure skips all suites**\n   - `_setup_corpus.txt` with a failing test\n   - Verify suites are skipped\n\n4. **Corpus teardown runs even when suites fail**\n   - Suite with failing test\n   - `_teardown_corpus.txt` still executes\n\n5. **CCTR_CORPUS_WORK_DIR available to suites**\n   - Corpus setup writes to CCTR_CORPUS_WORK_DIR\n   - Suite reads from CCTR_CORPUS_WORK_DIR\n\n## Acceptance Criteria\n- All test cases pass\n- Tests serve as documentation for the feature","status":"closed","priority":1,"issue_type":"task","owner":"ajansson@cloudflare.com","created_at":"2026-01-26T00:26:34.690997+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-26T00:42:37.913884+01:00","closed_at":"2026-01-26T00:42:37.913884+01:00","close_reason":"Scrapped - design issue with corpus root detection","dependencies":[{"issue_id":"cctr-0a7","depends_on_id":"cctr-k5x","type":"blocks","created_at":"2026-01-26T00:26:39.971625+01:00","created_by":"Andreas Jansson"},{"issue_id":"cctr-0a7","depends_on_id":"cctr-3hh","type":"blocks","created_at":"2026-01-26T00:26:40.08634+01:00","created_by":"Andreas Jansson"}]}
{"id":"cctr-2fp","title":"Improve constraint failure error messages","status":"closed","priority":1,"issue_type":"task","owner":"ajansson@cloudflare.com","created_at":"2026-01-23T21:31:21.141892+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-23T21:45:26.383303+01:00","closed_at":"2026-01-23T21:45:26.383303+01:00","close_reason":"Implemented improved constraint failure error messages that show variable bindings"}
{"id":"cctr-3hh","title":"Run corpus teardown after all suites complete","description":"Update the main runner to execute `_teardown_corpus.txt` once after all suites complete.\n\n## Location\n`crates/cctr/src/main.rs` (or runner orchestration)\n\n## Changes Needed\n\n1. After all suites complete (regardless of pass/fail), run corpus teardown\n2. Use the same corpus work directory from setup\n3. Report teardown results\n4. Clean up corpus temp directory after teardown\n\n## Error Handling\n- Corpus teardown runs even if suites failed\n- Teardown failures are reported but don't change overall exit code logic\n- (Or should teardown failure cause non-zero exit? TBD)\n\n## Acceptance Criteria\n- Corpus teardown runs after all suites\n- Teardown runs even when suites fail\n- Corpus work directory is cleaned up","status":"closed","priority":1,"issue_type":"task","owner":"ajansson@cloudflare.com","created_at":"2026-01-26T00:26:25.394876+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-26T00:34:37.348448+01:00","closed_at":"2026-01-26T00:34:37.348448+01:00","close_reason":"Implemented","dependencies":[{"issue_id":"cctr-3hh","depends_on_id":"cctr-j9r","type":"blocks","created_at":"2026-01-26T00:26:39.85443+01:00","created_by":"Andreas Jansson"}]}
{"id":"cctr-43k","title":"Support reading test from stdin with cctr -","status":"closed","priority":1,"issue_type":"feature","owner":"ajansson@cloudflare.com","created_at":"2026-01-23T17:18:30.307949+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-23T17:21:53.963326+01:00","closed_at":"2026-01-23T17:21:53.963326+01:00","close_reason":"Closed"}
{"id":"cctr-4oh","title":"Add JSON types: json_string, json_bool, json_array, json_object","status":"closed","priority":1,"issue_type":"feature","owner":"ajansson@cloudflare.com","created_at":"2026-01-23T16:00:49.052473+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-23T16:12:49.545177+01:00","closed_at":"2026-01-23T16:12:49.545177+01:00","close_reason":"Closed"}
{"id":"cctr-8bc","title":"Send TestStart event in run_from_stdin","description":"In `run_from_stdin`, send a `TestStart` event before calling `run_test` for each test (similar to run_corpus_file).\n\n## Location\n`crates/cctr/src/runner.rs` - `run_from_stdin` function (around line 447)\n\n## Required Change\nAdd TestStart event before run_test in the stdin runner as well.\n\n## Acceptance Criteria\n- TestStart event sent before each test runs when reading from stdin\n- Event includes correct suite (\"stdin\"), file, and test name","status":"closed","priority":2,"issue_type":"task","owner":"ajansson@cloudflare.com","created_at":"2026-01-25T23:57:16.99399+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-25T23:59:22.791453+01:00","closed_at":"2026-01-25T23:59:22.791453+01:00","close_reason":"Closed","dependencies":[{"issue_id":"cctr-8bc","depends_on_id":"cctr-lce","type":"blocks","created_at":"2026-01-25T23:57:49.25274+01:00","created_by":"Andreas Jansson"}]}
{"id":"cctr-9t0","title":"Replace with/having syntax with unified where clause","description":"Change cctr syntax from separate with/having sections to a single where clause. Make types optional in variable definitions with inline syntax like {{ x }}, {{ x: number }}, {{ x:string }}, {{ x : json object }}. Implement duck-typing for variables without explicit types: json string \u003e json array \u003e json object \u003e number \u003e bool \u003e string fallback.","status":"closed","priority":1,"issue_type":"task","owner":"ajansson@cloudflare.com","created_at":"2026-01-24T21:40:00.890667+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-26T00:28:59.529027+01:00","closed_at":"2026-01-26T00:28:59.529027+01:00","close_reason":"Completed"}
{"id":"cctr-bur","title":"Add negative test cases for JSON types","status":"closed","priority":2,"issue_type":"task","owner":"ajansson@cloudflare.com","created_at":"2026-01-23T16:57:40.534685+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-23T17:04:43.968867+01:00","closed_at":"2026-01-23T17:04:43.968867+01:00","close_reason":"Closed"}
{"id":"cctr-dof","title":"Modify print_verbose_result to only print status suffix","description":"Change `print_verbose_result` to only print the status suffix (pass/fail/skip + timing) since the test name is now printed by TestStart.\n\n## Location\n`crates/cctr/src/output.rs` - `print_verbose_result` function\n\n## Current Output Format\n```\n✓ suite/file: test name 0.02s\n```\n\n## New Output Format (combined with TestStart)\nTestStart prints: `suite/file: test name ... `\nTestComplete prints: `✓ 0.02s\\n`\nResult: `suite/file: test name ... ✓ 0.02s`\n\n## Required Changes\n1. Remove the test name printing (suite/file: name)\n2. Keep the status symbol (✓/✗/⊘/↺)\n3. Keep the timing or skip reason\n4. Add newline at end\n\n## Acceptance Criteria\n- Only prints status symbol + timing/reason + newline\n- Works correctly for passed, failed, skipped, and update modes","status":"closed","priority":2,"issue_type":"task","owner":"ajansson@cloudflare.com","created_at":"2026-01-25T23:57:34.897764+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-26T00:01:35.30894+01:00","closed_at":"2026-01-26T00:01:35.30894+01:00","close_reason":"Closed","dependencies":[{"issue_id":"cctr-dof","depends_on_id":"cctr-edz","type":"blocks","created_at":"2026-01-25T23:57:49.564164+01:00","created_by":"Andreas Jansson"}]}
{"id":"cctr-edz","title":"Handle TestStart event in print_progress","description":"In `print_progress`, add a match arm for `TestStart` that prints the test name without a newline (in verbose mode only).\n\n## Location\n`crates/cctr/src/output.rs` - `print_progress` function\n\n## Current Code\n```rust\npub fn print_progress(\u0026mut self, event: \u0026ProgressEvent, verbose: bool, update_mode: bool) {\n    match event {\n        ProgressEvent::TestComplete(result) =\u003e { ... }\n        ProgressEvent::Skip { suite, reason } =\u003e { ... }\n    }\n}\n```\n\n## Required Change\nAdd TestStart handling:\n```rust\nProgressEvent::TestStart { suite, file, name } =\u003e {\n    if verbose {\n        write!(self.stdout, \"{}/{}: {} ... \", suite, file, name).unwrap();\n        let _ = self.stdout.flush();\n    }\n    // In non-verbose mode, don't print anything for TestStart\n}\n```\n\n## Acceptance Criteria\n- In verbose mode: prints test name with \"...\" suffix, no newline, flushes stdout\n- In non-verbose mode: does nothing (dots printed on TestComplete)","status":"closed","priority":2,"issue_type":"task","owner":"ajansson@cloudflare.com","created_at":"2026-01-25T23:57:25.716183+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-26T00:00:01.268543+01:00","closed_at":"2026-01-26T00:00:01.268543+01:00","close_reason":"Closed","dependencies":[{"issue_id":"cctr-edz","depends_on_id":"cctr-lce","type":"blocks","created_at":"2026-01-25T23:57:49.402366+01:00","created_by":"Andreas Jansson"}]}
{"id":"cctr-f6o","title":"Add global corpus-level setup/teardown support","description":"Add support for `_setup_corpus.txt` and `_teardown_corpus.txt` at the test root level that run once globally before/after all suites.\n\n## Execution Order\n\n1. `test/_setup_corpus.txt` — runs once globally before any suites\n2. Suite setups run in parallel (`query/_setup.txt`, `workflows/_setup.txt`, etc.)\n3. Tests within each suite run sequentially\n4. Suite teardowns run in parallel\n5. `test/_teardown_corpus.txt` — runs once globally after all suites\n\n## Use Case\n\nStarting a server once for the entire test corpus instead of per-suite:\n\n```\ntest/\n  _setup_corpus.txt      # Global: starts server once\n  _teardown_corpus.txt   # Global: stops server once\n  query/\n    _setup.txt           # Suite-specific setup\n    *.txt\n  workflows/\n    _setup.txt           # Suite-specific setup\n    *.txt\n  admin/\n    *.txt\n```\n\n## Constraints\n\n- Only one `_setup_corpus.txt` allowed in the corpus (at root level)\n- Only one `_teardown_corpus.txt` allowed in the corpus (at root level)\n- If corpus setup fails, skip all suites\n- Corpus teardown runs even if some suites fail\n\n## Implementation Notes\n\n- Detect `_setup_corpus.txt` / `_teardown_corpus.txt` in test root during discovery\n- Run corpus setup before spawning parallel suite execution\n- Run corpus teardown after all suites complete\n- Corpus setup/teardown should have access to `CCTR_WORK_DIR` env var\n- Need to decide if corpus setup creates a shared temp dir or uses root dir","status":"closed","priority":1,"issue_type":"feature","owner":"ajansson@cloudflare.com","created_at":"2026-01-26T00:25:56.215169+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-26T00:42:37.915757+01:00","closed_at":"2026-01-26T00:42:37.915757+01:00","close_reason":"Scrapped - design issue with corpus root detection"}
{"id":"cctr-io5","title":"Add adversarial tests for JSON types","status":"closed","priority":1,"issue_type":"task","owner":"ajansson@cloudflare.com","created_at":"2026-01-23T17:10:33.692048+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-23T17:16:57.0159+01:00","closed_at":"2026-01-23T17:16:57.0159+01:00","close_reason":"Closed"}
{"id":"cctr-j9r","title":"Detect corpus-level setup/teardown files in discovery","description":"Update the discovery module to detect `_setup_corpus.txt` and `_teardown_corpus.txt` at the test root level.\n\n## Location\n`crates/cctr/src/discover.rs`\n\n## Changes Needed\n\n1. Add fields to track corpus-level setup/teardown existence\n2. During discovery, check for `_setup_corpus.txt` and `_teardown_corpus.txt` at the root path\n3. Return this information alongside the list of suites\n\n## Options\n\nOption A: Add a `CorpusInfo` struct returned by `discover_suites`:\n```rust\npub struct CorpusInfo {\n    pub root: PathBuf,\n    pub has_corpus_setup: bool,\n    pub has_corpus_teardown: bool,\n    pub suites: Vec\u003cSuite\u003e,\n}\n```\n\nOption B: Return a tuple `(Vec\u003cSuite\u003e, Option\u003cPathBuf\u003e, Option\u003cPathBuf\u003e)` for suites and setup/teardown paths\n\n## Acceptance Criteria\n- `_setup_corpus.txt` at root is detected\n- `_teardown_corpus.txt` at root is detected\n- These files are NOT treated as test files or suite setup files","status":"closed","priority":1,"issue_type":"task","owner":"ajansson@cloudflare.com","created_at":"2026-01-26T00:26:05.268259+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-26T00:28:59.531366+01:00","closed_at":"2026-01-26T00:28:59.531366+01:00","close_reason":"Completed"}
{"id":"cctr-k5x","title":"Run corpus setup before parallel suite execution","description":"Update the main runner to execute `_setup_corpus.txt` once before any suites start.\n\n## Location\n`crates/cctr/src/main.rs` (or create new orchestration in `runner.rs`)\n\n## Changes Needed\n\n1. After discovery, check if corpus setup exists\n2. Create a temp directory for corpus-level work\n3. Run corpus setup tests (all must pass)\n4. If corpus setup fails, skip all suites and report error\n5. Pass corpus work directory to suites via env var\n\n## Environment Variables\n- `CCTR_CORPUS_WORK_DIR` — shared directory created for corpus setup, available to all suites\n- Suites still get their own `CCTR_WORK_DIR` for isolation\n\n## Error Handling\n- If any test in `_setup_corpus.txt` fails, abort and report\n- Show which setup test failed\n- Don't run any suites\n\n## Acceptance Criteria\n- Corpus setup runs before any suite\n- Corpus setup failure prevents suite execution\n- Progress events sent for corpus setup tests","status":"closed","priority":1,"issue_type":"task","owner":"ajansson@cloudflare.com","created_at":"2026-01-26T00:26:16.104565+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-26T00:34:37.346935+01:00","closed_at":"2026-01-26T00:34:37.346935+01:00","close_reason":"Implemented","dependencies":[{"issue_id":"cctr-k5x","depends_on_id":"cctr-j9r","type":"blocks","created_at":"2026-01-26T00:26:39.725743+01:00","created_by":"Andreas Jansson"}]}
{"id":"cctr-lce","title":"Add TestStart variant to ProgressEvent enum","description":"Add a new `TestStart` variant to the `ProgressEvent` enum in `runner.rs`.\n\n## Location\n`crates/cctr/src/runner.rs`\n\n## Current Code\n```rust\n#[derive(Debug, Clone)]\npub enum ProgressEvent {\n    TestStart {\n        suite: String,\n        file: String,\n        name: String,\n    },\n    TestComplete(Box\u003cTestResult\u003e),\n    Skip { suite: String, reason: String },\n}\n```\n\n## Task\nThis is already done - the TestStart variant was added in the previous commit. Just verify it's correct.\n\n## Acceptance Criteria\n- `TestStart` variant exists with suite, file, and name fields\n- Code compiles","status":"closed","priority":2,"issue_type":"task","owner":"ajansson@cloudflare.com","created_at":"2026-01-25T23:57:01.051748+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-25T23:58:18.951419+01:00","closed_at":"2026-01-25T23:58:18.951419+01:00","close_reason":"Already implemented in previous commit"}
{"id":"cctr-ltp","title":"Replace in/not in with contains for arrays","status":"closed","priority":1,"issue_type":"task","owner":"ajansson@cloudflare.com","created_at":"2026-01-24T21:18:04.605327+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-24T21:24:51.506524+01:00","closed_at":"2026-01-24T21:24:51.506526+01:00"}
{"id":"cctr-m2b","title":"Send TestStart event before running tests in run_corpus_file","description":"In `run_corpus_file`, send a `TestStart` event before calling `run_test` for each test.\n\n## Location\n`crates/cctr/src/runner.rs` - `run_corpus_file` function (around line 250)\n\n## Current Code\n```rust\nfor test in corpus.tests {\n    // ... pattern matching ...\n    \n    let result = run_test(\u0026test, work_dir, suite_name, env_vars);\n    if let Some(tx) = progress_tx {\n        let _ = tx.send(ProgressEvent::TestComplete(Box::new(result.clone())));\n    }\n    results.push(result);\n}\n```\n\n## Required Change\nAdd TestStart event before run_test:\n```rust\nfor test in corpus.tests {\n    // ... pattern matching ...\n    \n    if let Some(tx) = progress_tx {\n        let file_stem = file_path.file_stem()\n            .and_then(|s| s.to_str())\n            .unwrap_or(\"\")\n            .to_string();\n        let _ = tx.send(ProgressEvent::TestStart {\n            suite: suite_name.to_string(),\n            file: file_stem,\n            name: test.name.clone(),\n        });\n    }\n    \n    let result = run_test(\u0026test, work_dir, suite_name, env_vars);\n    // ...\n}\n```\n\n## Acceptance Criteria\n- TestStart event sent before each test runs\n- Event includes correct suite, file, and test name","status":"closed","priority":2,"issue_type":"task","owner":"ajansson@cloudflare.com","created_at":"2026-01-25T23:57:10.193679+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-25T23:58:47.556057+01:00","closed_at":"2026-01-25T23:58:47.556057+01:00","close_reason":"Closed","dependencies":[{"issue_id":"cctr-m2b","depends_on_id":"cctr-lce","type":"blocks","created_at":"2026-01-25T23:57:49.096932+01:00","created_by":"Andreas Jansson"}]}
{"id":"cctr-ris","title":"cctr should run only tests in specified file, not entire directory","status":"closed","priority":1,"issue_type":"bug","owner":"ajansson@cloudflare.com","created_at":"2026-01-23T17:02:30.64222+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-23T17:04:43.856673+01:00","closed_at":"2026-01-23T17:04:43.856673+01:00","close_reason":"Closed"}
{"id":"cctr-rmf","title":"Update verbose mode test expectations","description":"Update the test expectations in the verbose test suite to match the new output format.\n\n## Location\n`test/verbose/` and `test/skip/skip.txt`\n\n## Current Expected Format\n```\n✓ suite/file: test name 0.02s\n```\n\n## New Expected Format\n```\nsuite/file: test name ... ✓ 0.02s\n```\n\n## Files to Update\n- `test/verbose/verbose.txt` - update expected output for verbose mode tests\n- `test/skip/skip.txt` - update the \"verbose output shows skip marker\" and \"verbose output shows skip reason\" tests\n\n## Acceptance Criteria\n- All verbose-related tests pass with new format\n- Skip output format is also updated","notes":"Changed approach: instead of start+suffix format, use two separate lines: 'starting TEST NAME' and 'STATUS TEST NAME TIME'. This handles parallel execution correctly.","status":"closed","priority":2,"issue_type":"task","owner":"ajansson@cloudflare.com","created_at":"2026-01-25T23:57:43.029622+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-26T00:16:16.055224+01:00","closed_at":"2026-01-26T00:16:16.055224+01:00","close_reason":"Implemented verbose mode with 'starting' line before each test","dependencies":[{"issue_id":"cctr-rmf","depends_on_id":"cctr-dof","type":"blocks","created_at":"2026-01-25T23:57:49.709527+01:00","created_by":"Andreas Jansson"}]}
{"id":"cctr-t4t","title":"Add 'not in' operator as shorthand for 'not (x in y)'","status":"closed","priority":2,"issue_type":"feature","owner":"ajansson@cloudflare.com","created_at":"2026-01-24T16:55:51.483238+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-24T16:59:10.542358+01:00","closed_at":"2026-01-24T16:59:10.542358+01:00","close_reason":"Added 'not in' operator as shorthand for 'not (x in y)'"}
{"id":"cctr-v01","title":"Refactor json_types tests into separate files per type","status":"closed","priority":2,"issue_type":"task","owner":"ajansson@cloudflare.com","created_at":"2026-01-23T17:07:24.583825+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-23T17:08:54.599048+01:00","closed_at":"2026-01-23T17:08:54.599048+01:00","close_reason":"Closed"}
{"id":"cctr-vlc","title":"Print test name at start in verbose mode","description":"In verbose (-v) mode, print the test name when the test STARTS running, then append the status (pass/fail/skip + timing) as a suffix when it completes. This allows catching hanging tests by seeing the name on screen without a status suffix.\n\n## Current Behavior\nCurrently in verbose mode, the entire line is printed after the test completes:\n```\n✓ suite/file: test name 0.02s\n```\n\n## Desired Behavior\nPrint the test name first (without status), then append status when done:\n```\nsuite/file: test name ... ✓ 0.02s\n```\nOr for skipped tests:\n```\nsuite/file: test name ... ⊘ (skip reason)\n```\n\n## Implementation Notes\n- Add a `TestStart` variant to `ProgressEvent` enum\n- Send `TestStart` event before running each test\n- Handle `TestStart` in `print_progress` to print test name without newline\n- Modify `print_verbose_result` to only print the status suffix","status":"closed","priority":2,"issue_type":"feature","owner":"ajansson@cloudflare.com","created_at":"2026-01-25T23:56:53.228088+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-26T00:16:16.056774+01:00","closed_at":"2026-01-26T00:16:16.056774+01:00","close_reason":"Implemented verbose mode with 'starting' line before each test"}
{"id":"cctr-wky","title":"Replace with/having with single where clause and inline types","description":"Change cctr syntax: (1) Replace with/having with single where clause, (2) Inline types in variables {{ x: number }}, (3) Duck-type variables without explicit types, (4) Remove {{ VAR }} template syntax - use normal ${VAR} shell syntax, (5) Inject $CCTR_FIXTURE_DIR and $CCTR_WORK_DIR as environment variables instead of {{ FIXTURE_DIR }}/{{ WORK_DIR }}","status":"closed","priority":1,"issue_type":"feature","owner":"ajansson@cloudflare.com","created_at":"2026-01-24T21:40:41.662074+01:00","created_by":"Andreas Jansson","updated_at":"2026-01-24T23:28:01.726571+01:00","closed_at":"2026-01-24T23:28:01.726573+01:00"}
